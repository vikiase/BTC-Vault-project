<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Prices    </title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background-color: #121212; /* Tmavé pozadí */
            color: #e0e0e0; /* Světle šedý text pro tmavý režim */
        }
        .container {
            width: 90%;
            margin: 0 auto;
            padding: 20px;
        }
        .dashboard-header {
            text-align: center;
            color: #fff; /* Bílý text */
        }
        .prices {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
        }
        .price-box {
            text-align: center;
            padding: 20px;
            border: 1px solid #333; /* Tmavý okraj */
            width: 20%;
            border-radius: 10px;
            background: #1f1f1f; /* Tmavé pozadí pro boxy */
            color: #fff; /* Světle šedý text */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        .price-box h3 {
            margin-bottom: 10px;
            color: #76c7c0; /* Světle modrá pro nadpisy */
        }
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        .chart-container {
            width: 100%;
            background: #1f1f1f;
            padding: 15px;
            border: 1px solid #333;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            box-sizing: border-box;
        }
        .chart-container h3 {
            text-align: center;
            margin-bottom: 10px;
            color: #76c7c0;
        }
        canvas {
            max-width: 100%;
            max-height: 400px; /* Omezit výšku grafu */
            display: block;
        }
        /* Tmavý režim pro legendu v grafech */
        .chartjs-legend {
            color: #fff;
        }
        .chartjs-tooltip {
            background-color: #333;
            color: #fff;
        }
        h2 {
            color: #76c7c0; /* Světle modrá pro nadpisy */
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="dashboard-header">Crypto Prices</h1>
        <br><br>
        <h2>Current Prices</h2>
        <div class="prices">
            <!-- Aktuální ceny -->
            {% for pair, prices in current_prices.items() %}
                <div class="price-box">
                    <h3>{{  pair.split('/')[0] }}</h3>
                    <p>{{ prices['CZK'] }} CZK</p>
                    <p>{{ prices['USD'] }} USD</p>
                </div>
            {% endfor %}
        </div>
        <br>
        <h2>5Y Graphs</h2>
        <div class="charts-grid">
            {% for pair, data in historical_prices.items() %}
                <div class="chart-container">
                    <h3>Historical Data for {{ pair }}</h3>
                    <canvas id="chart_{{ pair }}"></canvas>
                </div>
            {% endfor %}
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function () {
        const historicalData = {{ historical_prices | tojson }};

        Object.entries(historicalData).forEach(([pair, data]) => {
            const ctx = document.getElementById(`chart_${pair}`);
            if (!ctx) {
                console.error(`Canvas element for ${pair} not found!`);
                return;
            }

            // Format timestamps for axis
            const formattedTimestamps = data.timestamps.map(timestamp => {
                const date = new Date(timestamp);
                return date.toISOString().split('T')[0]; // YYYY-MM-DD
            });

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: formattedTimestamps, // X-osy
                    datasets: [{
                        label: `${pair} Price (USD)`,
                        data: data.prices, // Y-osy
                        borderColor: 'rgba(75, 192, 192, 1)', // Světle modrá čára
                        backgroundColor: 'rgba(75, 192, 192, 0.2)', // Světle modré pozadí grafu
                        borderWidth: 2,
                        tension: 0.4,
                        pointRadius: 3,
                        pointHoverRadius: 5,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true, /* Zajištění pevného poměru stran */
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                font: {
                                    size: 14,
                                    color: '#fff' /* Změněná barva legendy na bílou */
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Date (YYYY-MM-DD)',
                                color: '#fff', /* Bílý text na ose X */
                                font: {
                                    size: 12
                                }
                            },
                            ticks: {
                                color: '#aaa', /* Světle šedé označení na ose X */
                                font: {
                                    size: 10
                                }
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Price (USD)',
                                color: '#fff', /* Bílý text na ose Y */
                                font: {
                                    size: 12
                                }
                            },
                            ticks: {
                                color: '#aaa', /* Světle šedé označení na ose Y */
                                font: {
                                    size: 10
                                }
                            }
                        }
                    }
                }
            });
        });
    });
    </script>

</body>
</html>
